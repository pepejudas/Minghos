<!DOCTYPE html>
<html>
  <script src="js/proceso.js"  type="text/javascript"></script>
  <script src="js/translation.js"  type="text/javascript"></script>    
  <script src="js/frameworkm.js"  type="text/javascript"></script>
  <body>
    <span><span id="divprocselector"></span>
      <select id='procselector'><option></option><option>Proceso1</option><option>Proceso2</option></select></span>&nbsp;
    <span><select><option>Control1</option><option>Control2</option><option>Control3</option></select></span></span>
<canvas id="myCanvas" width="1" height="1">
  Your browser does not support the HTML5 canvas tag.</canvas>
<script>
  //loading translations and process
  try{
  document.getElementById('divprocselector').innerHTML = f.lT('selectorproceso');

  // get reference to select element
  var sel = document.getElementById('procselector');
  // create new option element
  var opt = document.createElement('option');
  // create text node to add to option element (opt)
  opt.appendChild( document.createTextNode('New Option Text') );
  // set value property of opt
  opt.value = 'option value'; 
  // add opt to end of select box (sel)
  sel.appendChild(opt);
  }catch(e){
  f.pTC(e);
  }
  
var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");

ctx.font = "13px Arial";
ctx.canvas.width  = window.innerWidth-28;
ctx.canvas.height = window.innerHeight-40;

//cuadrado de operacion
function rectOp(ctx1, x, y, operacion, responsable, orden, link){
w=180;
h=60;
s=5;
sr = 160;
yop = y + 20;
yr = y + 40;
font = "10px Arial #000";

ctx1.beginPath();
ctx1.rect(x, y, w, h);
ctx1.fillStyle = '#ccc';
ctx1.fill();
ctx1.lineWidth = 1;
ctx1.strokeStyle = 'black';
ctx1.stroke();

//line 1
var yl1 = 30;

ctx1.beginPath();
ctx1.moveTo(x, y+yl1);
ctx1.lineTo(x+w, y+yl1);
ctx1.stroke();

ctx1.font = font;
ctx1.fillStyle = '#000';
//ctx1.fillText(operacion, x+s, yop);

ctx1.font = font;
ctx1.fillStyle = '#000';
ctx1.fillText(responsable, x+s, yr);

ctx1.font = font;
ctx1.fillStyle = '#000';
ctx1.fillText(orden, x+sr, yr);

drawLink(ctx.canvas, x+5, y+10,link,operacion);

//ctx1.fillText(reponsable, x+s, yr);
//ctx1.fillText(orden, x+sr,yor);
}

var isLink = false;
 
function drawHyperLink() {
canvas = document.getElementById("myCanvas");
// check if supported
if (canvas.getContext) {
ctx = canvas.getContext("2d");
ctx.font = linkHeight + 'px sans-serif';
ctx.fillStyle = "#0000ff";
ctx.fillText(linkText, linkX, linkY);
linkWidth = ctx.measureText(linkText).width;

canvas.addEventListener("mousemove", CanvasMouseMove, false);
canvas.addEventListener("click", Link_click, false);
}
}

function CanvasMouseMove(e) {
var x, y;
if (e.layerX || e.layerX == 0) { // for firefox
x = e.layerX;
y = e.layerY;
}
x -= canvas.offsetLeft;
y -= canvas.offsetTop;

if (x >= linkX && x <= (linkX + linkWidth) && y <= linkY && y >= (linkY - linkHeight)) {
document.body.style.cursor = "pointer";
isLink = true;
}else{
		       
document.body.style.cursor = "";
isLink = false;
		       
}
}
/*
		       
function Link_click(e){
   if (isLink) {
     window.location = linkText;
   }
		       }
*/
// Links
var Links = new Array(); // Links information
var hoverLink = ""; // Href of the link which cursor points at
ctx.fillStyle = "#0000ff"; // Default blue link color
ctx.font = "12px Arial #ccc"; // Monospace font for links
ctx.textBaseline = "top"; // Makes left top point a start point for rendering text

        // Draw the link
        function drawLink(canvas, x,y,href,title){
            var linkTitle = title,
                linkX = x,
                linkY = y,
                linkWidth = ctx.measureText(linkTitle).width,
                linkHeight = parseInt(ctx.font); // Get lineheight out of fontsize

            // Draw the link
            ctx.fillText(linkTitle, linkX, linkY);

            // Add mouse listeners
            canvas.addEventListener("mousemove", on_mousemove, false);
            canvas.addEventListener("click", on_click, false);

            // Add link params to array
            Links.push(x + ";" + y + ";" + linkWidth + ";" + linkHeight + ";" + href);
        }

        // Link hover
        function on_mousemove (ev) {
            var x, y;

            // Get the mouse position relative to the canvas element
            if (ev.layerX || ev.layerX == 0) { // For Firefox
                x = ev.layerX;
                y = ev.layerY;
            }

            // Link hover
            for (var i = Links.length - 1; i >= 0; i--) {
                var params = new Array();

                // Get link params back from array
                params = Links[i].split(";");

                var linkX = parseInt(params[0]),
                    linkY = parseInt(params[1]),
                    linkWidth = parseInt(params[2]),
                    linkHeight = parseInt(params[3]),
                    linkHref = params[4];

                // Check if cursor is in the link area
                if (x >= linkX && x <= (linkX + linkWidth) && y >= linkY && y <= (linkY + linkHeight)){
                    document.body.style.cursor = "pointer";
                    hoverLink = linkHref;
                    break;
                }else{
                    document.body.style.cursor = "";
                    hoverLink = "";
                }
            };
        }

        // Link click
        function on_click(e) {
            if (hoverLink){
                window.open(hoverLink); // Use this to open in new tab
                //window.location = hoverLink; // Use this to open in current window
            }
        }

//funcion para dibujar lineas horizontales en todo el canvas
function drawLinesH(ctx1){

var x = 10;
var y = 0;
var x1= ctx1.canvas.width-2;
	       

for(var i=0;i<150;i++){

y=i*20;
ctx1.beginPath();
ctx1.moveTo(0, y);
ctx1.lineTo(x1, y);
ctx1.strokeStyle = '#0ff';
ctx1.stroke();
}
		   
	       }

function drawLinesV(ctx1){

var x = 10;
var y = ctx1.canvas.height-2;
var x1= 0;
	       

for(var i=0;i<190;i++){

x1=i*20;
	       
ctx1.beginPath();
ctx1.moveTo(x1, 0);
ctx1.lineTo(x1, y);
ctx1.strokeStyle = '#0ff';
ctx1.stroke();
}
		   
}
		       
drawLinesH(ctx);
drawLinesV(ctx);
	       
  var procs= document.getElementById('procselector');
  procs.addEventListener('click', function(){

  switch(procs.value){
  case 'Proceso1':
  rectOp(ctx, 200, 50,'Texto de Proceso 1 Operacion 1', 'auxiliar1', '1', 'http://www.google.com');
  rectOp(ctx, 200, 150,'Texto de Proceso 1 Operacion 2', 'medico1', '2', 'http://duckduckgo.com');
  rectOp(ctx, 200, 250,'Texto de Proceso 1 Operacion 3', 'auxiliar2','3','http://altavista.com');
  rectOp(ctx, 200, 350,'Texto de Proceso 1 Operacion 4', 'auxiliar2','4','http://yahoo.com');
  rectOp(ctx, 200, 450,'Texto de Proceso 1 Operacion 5', 'auxiliar2','5','http://microsoft.com');
  rectOp(ctx, 200, 550,'Texto de Proceso 1 Operacion 6', 'auxiliar2','6','http://xsitecompany.net');
  rectOp(ctx, 200, 650,'Texto de Proceso 1 Operacion 7', 'auxiliar2','7','http://juegos.com');
  console.log('selecciono'+ procs.value);
  break;
  case 'Proceso2':
  rectOp(ctx, 200, 50,'Texto de Proceso 2 Operacion 1', 'auxiliar1', '1');
  rectOp(ctx, 200, 150,'Texto de Proceso 2 Operacion 2', 'medico1', '2');
  rectOp(ctx, 200, 250,'Texto de Proceso 2 Operacion 3', 'auxiliar2','3');
  console.log('selecciono'+ procs.value);
  break;
  }
  
	       });
</script>
</body>
</html>
